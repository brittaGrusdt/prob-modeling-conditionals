// Model ---------------------------------------------------------------------
var literal_listener = cache(function(utterance, bias){
  Infer({method:'enumerate',model: function(){
    var state = sample(globalStore.state_prior)
    condition(meaning(utterance, state["bn"]["table"]))
    return state
  }})
}, 10000)

var speaker = cache(function(state, bias, displayU){
  let distr = Infer({method:'enumerate', model: function(){
    var utterance = uniformDraw(globalStore.utterances)
    var ll = literal_listener(utterance, bias)
    var utility = ll.score(state)
    // utility == -Infinity ? utility : globalStore.alpha * (utility-costs(utterance))
    if(displayU && utility != -Infinity){
      display(utterance + utility)
    }
    factor(globalStore.alpha * (utility - costs(utterance)))
    return(utterance)
    }
  });
 return(distr)
}, 10000)

var listener = function(utterance, bias){
  return Infer({method:'enumerate', model:function(){
                  var state = sample(globalStore.state_prior)
                  var sp = speaker(state, bias, false)
                  observe(sp, utterance)
                  return state
                }})
}
